private void listAndCompareFiles(String directory, List<String> localFiles, List<String> filesToReplace) throws SftpException {
    sftpChannel.cd(directory);
    List<ChannelSftp.LsEntry> entries = sftpChannel.ls("*");

    logger.info("Checking remote directory: " + directory);
    for (ChannelSftp.LsEntry entry : entries) {
        if (entry.getAttrs().isDir()) {
            // Recursively check subdirectories
            listAndCompareFiles(directory + "/" + entry.getFilename(), localFiles, filesToReplace);
        } else {
            String remoteFilePath = directory + "/" + entry.getFilename();
            String relativeRemotePath = remoteFilePath.substring(this.remoteFilePath.length()).replace("\\", "/");

            logger.info("Remote file relative path: " + relativeRemotePath);  // Log the remote relative path

            if (localFiles.contains(relativeRemotePath)) {
                logger.info("File matched for download: " + relativeRemotePath);  // Log the matching file
                filesToReplace.add(remoteFilePath);  // Add file to the list to be downloaded
            }
        }
    }
}