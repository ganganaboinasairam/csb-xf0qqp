function escapeHtml(unsafe) {
    // Replace specific sequences with unique placeholders
    let safeContent = unsafe
        .replace(/<%/g, "<<<%") // Unique placeholder for `<%`
        .replace(/%>/g, "%>>>"); // Unique placeholder for `%>`

    // Escape all HTML characters
    safeContent = safeContent
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");

    // Restore specific sequences
    safeContent = safeContent
        .replace(/<<<%/g, "<%")
        .replace(/%>>>/g, "%>");

    return safeContent;
}