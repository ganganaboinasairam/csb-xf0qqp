import java.io.*;
import java.nio.file.*;
import java.util.Properties;
import com.jcraft.jsch.*;

public static void fail(Exception e2, String filename, String contractId) {
    String fileName = filename;
    int dotIndex = fileName.lastIndexOf(".");
    String onlyFileName = (dotIndex == -1) ? fileName : fileName.substring(0, dotIndex);
    String fail;

    // Check if the exception message contains "ORA-00001"
    if (e2.getMessage().contains("ORA-00001")) {
        fail = onlyFileName + contractId + "_duplicate";
    } else {
        fail = onlyFileName + contractId + "_fail";
    }

    String absoluteFilePath = fail + ".txt";
    File file = new File(absoluteFilePath);

    Properties pr2 = new Properties();
    try {
        // Load properties from the specified file
        pr2.load(new FileInputStream("properties/XmlReadPath.properties"));
        String outbox = pr2.getProperty("ackPath");
        String localOutbox = pr2.getProperty("localOutbox");

        // Prepare the content for the failure file
        String fileData = "Contract ID: " + contractId + " from " + onlyFileName + " failed due to reason " + e2;
        Files.write(Paths.get(absoluteFilePath), fileData.getBytes(), StandardOpenOption.CREATE);

        // Copy the file to the SFTP server
        sftpChannel.cd(outbox);
        if (file.isFile()) {
            String put = outbox + file.getName();
            try (InputStream ins = new FileInputStream(file)) {
                sftpChannel.put(ins, put);
            }
            // Copy the file to the local path
            Files.copy(file.toPath(), Paths.get(localOutbox, file.getName()), StandardCopyOption.REPLACE_EXISTING);
            file.delete();
        }
    } catch (SftpException | FileNotFoundException e) {
        e.printStackTrace();
    } catch (IOException e) {
        e.printStackTrace();
    }

    logg.info("Failure Acknowledgement generated: " + onlyFileName);
}