package com;

import java.io.IOException;
import java.nio.file.DirectoryStream;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.text.SimpleDateFormat;
import java.util.Date;

public class DailyFolderUpdater {
    public static void main(String[] args) {
        // Define the desktop path
        String desktopPath = System.getProperty("user.home") + "\\Desktop";
        Path todayFolderPath = Paths.get(desktopPath, "TODAY");

        // Define the destination path
        String destinationPath = "F:\\SAIRAM\\";
        Path destinationDirPath = Paths.get(destinationPath);

        // Get the current date in dd-MM-yyyy format
        String formattedDate = new SimpleDateFormat("dd-MM-yyyy").format(new Date());

        // Define the new folder path
        Path newFolderPath = Paths.get(destinationPath, formattedDate);

        // Ensure the destination directory exists
        try {
            if (!Files.exists(destinationDirPath)) {
                Files.createDirectories(destinationDirPath);
                System.out.println("Destination directory created: " + destinationPath);
            }
        } catch (IOException e) {
            System.err.println("Failed to create destination directory: " + destinationPath);
            e.printStackTrace();
            return;
        }

        // Create the new folder for today's date
        try {
            if (Files.exists(newFolderPath)) {
                // Handle existing folder - clear its contents
                System.out.println("The folder already exists. Clearing its contents.");
                deleteDirectory(newFolderPath); // Clear existing folder contents
            }
            Files.createDirectory(newFolderPath);
            System.out.println("New folder created: " + newFolderPath.toAbsolutePath());
        } catch (IOException e) {
            System.err.println("Failed to create or clear destination folder: " + newFolderPath.toAbsolutePath());
            e.printStackTrace();
            return;
        }

        // Move the "TODAY" folder's contents to the new folder
        moveContents(todayFolderPath, newFolderPath);

        // Delete the old "TODAY" folder after moving its contents
        try {
            if (Files.exists(todayFolderPath)) {
                deleteDirectory(todayFolderPath);
                System.out.println("Old 'TODAY' folder deleted.");
            }
        } catch (IOException e) {
            System.err.println("Failed to delete old 'TODAY' folder.");
            e.printStackTrace();
        }

        // Create a new "TODAY" folder
        Path newTodayFolderPath = Paths.get(desktopPath, "TODAY");
        try {
            if (!Files.exists(newTodayFolderPath)) {
                Files.createDirectory(newTodayFolderPath);
                System.out.println("New 'TODAY' folder created.");
            }
        } catch (IOException e) {
            System.err.println("Failed to create 'TODAY' folder.");
            e.printStackTrace();
        }
    }

    // Method to move contents from source to destination
    private static void moveContents(Path source, Path destination) {
        if (Files.exists(source)) {
            try (DirectoryStream<Path> stream = Files.newDirectoryStream(source)) {
                for (Path entry : stream) {
                    Path targetPath = destination.resolve(entry.getFileName());
                    if (Files.isDirectory(entry)) {
                        if (!Files.exists(targetPath)) {
                            Files.createDirectory(targetPath);
                        }
                        moveContents(entry, targetPath); // Recursive call for directories
                    } else {
                        Files.move(entry, targetPath);
                        System.out.println("Moved: " + entry.toAbsolutePath() + " to " + targetPath.toAbsolutePath());
                    }
                }
            } catch (IOException e) {
                System.err.println("Failed to move contents from folder: " + source.toAbsolutePath() + " to " + destination.toAbsolutePath());
                e.printStackTrace();
            }
        } else {
            System.err.println("Source folder does not exist: " + source.toAbsolutePath());
        }
    }

    // Method to delete a directory and its contents
    private static void deleteDirectory(Path path) throws IOException {
        if (Files.isDirectory(path)) {
            try (DirectoryStream<Path> stream = Files.newDirectoryStream(path)) {
                for (Path entry : stream) {
                    deleteDirectory(entry);
                }
            }
        }
        Files.delete(path);
    }
}