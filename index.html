package com.cs.ceweb.servlets;

import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.json.JSONObject;

import com.cs.core.dao.DSManager;

public class getRailLCDetailss extends HttpServlet{
	
	 /**
	 * 
	 */
	private static final long serialVersionUID = 1L;

	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		 
		 String requestType = request.getParameter("reqType");
	        String contractId = request.getParameter("contractId");
			java.sql.Connection conn =null;
			java.sql.PreparedStatement pstmt =null;
			java.sql.ResultSet rs=null;
			try {
	            response.setContentType("application/json");
	            conn = DSManager.getConnection("CET");
			if (requestType.equals("getContractDetails") && contractId != null && !contractId.isEmpty()) {
	try {
       
		conn = DSManager.getConnection("CET");
        String query = "SELECT STATUS, LC_NO FROM INIS_MASTER WHERE CONTRACT_ID = ?";
        pstmt = conn.prepareStatement(query);
        pstmt.setString(1, contractId);
        rs = pstmt.executeQuery();

        if (rs.next()) {
            String status = rs.getString("STATUS");
            String lcNo = rs.getString("LC_NO");

            JSONObject responseJson = new JSONObject();
            responseJson.put("contractId", contractId);
            responseJson.put("status", status);
            responseJson.put("lcNo", lcNo);

            String jsonResponse = responseJson.toString();
            response.getWriter().write(jsonResponse);
        } else {
            response.setContentType("application/json");
            response.getWriter().write("{\"error\": \"Invalid Contract ID, Please check\"}");
        }

    } catch (Exception e) {
        e.printStackTrace();
        response.setContentType("application/json");
        response.getWriter().write("{\"error\": \"An error occurred\"}");
    }
	} else if (requestType.equals("validateContractID") && contractId != null && !contractId.isEmpty()) {
        try {
            System.out.println("Validating contractId: " + contractId);

            String query = "SELECT STATUS, LC_NO FROM INIS_MASTER WHERE CONTRACT_ID = ?";
            pstmt = conn.prepareStatement(query);
            pstmt.setString(1, contractId);
            rs = pstmt.executeQuery();

            if (rs.next()) {
                String status = rs.getString("STATUS");
                String lcNo = rs.getString("LC_NO");

                JSONObject responseJson = new JSONObject();
                responseJson.put("contractId", contractId);
                responseJson.put("status", status);
                responseJson.put("lcNo", lcNo);

                String jsonResponse = responseJson.toString();
                response.getWriter().write(jsonResponse);
            } else {
                response.setContentType("application/json");
                response.getWriter().write("{\"error\": \"Invalid Contract ID, Please check\"}");
            }

        } catch (Exception e) {
            e.printStackTrace();
            response.setContentType("application/json");
            response.getWriter().write("{\"error\": \"An error occurred\"}");
        }
    } else {
        response.setContentType("application/json");
        response.getWriter().write("{\"error\": \"Invalid request\"}");
    }
	 } catch (Exception e) {
         e.printStackTrace();
         System.out.println("Exception for GetRailLCDetails");
finally{
	try{
		
		if (rs!=null) rs.close();
		if (pstmt!=null) pstmt.close();
		if (conn!=null) conn.close();
	}catch(Exception e){
		e.printStackTrace();
	}
}
}
}
