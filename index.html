<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSP Div Converter</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .result {
            margin-top: 20px;
        }
        .panel {
            display: none;
            transition: max-height 0.2s ease-out;
            padding: 0 18px;
        }
        .accordion {
            background-color: #652a84;
            color: white;
            text-align: left;
            transition: 0.4s;
            cursor: pointer;
            padding: 7.3px;
            border: none;
            outline: none;
            font-size: 15px;
            font-family: roboto-regular;
            border-radius: 5px;
        }
    </style>
</head>
<body>

<h1>JSP Div Converter</h1>
<p>Select a JSP file to convert the div structures.</p>
<input type="file" id="jspFile" accept=".jsp"><br>
<button onclick="convertDivs()">Convert Divs</button>

<div class="result" id="result"></div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
function readFile(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsText(file);
    });
}

function convertDivs() {
    const fileInput = document.getElementById('jspFile');
    const resultDiv = document.getElementById('result');

    if (fileInput.files.length === 0) {
        alert("Please select a JSP file.");
        return;
    }

    const file = fileInput.files[0];
    readFile(file).then(content => {
        const parser = new DOMParser();
        const doc = parser.parseFromString(content, 'text/html');

        const tabDivs = doc.querySelectorAll('.Tab');
        if (tabDivs.length === 0) {
            alert("No divs with class 'Tab' found in the JSP file.");
            return;
        }

        tabDivs.forEach((tabDiv, index) => {
            const title = tabDiv.getAttribute('title');
            if (title) {
                const outputDiv = createOutputDiv(tabDiv, title, index + 1);
                tabDiv.parentNode.replaceChild(outputDiv, tabDiv);
            }
        });

        resultDiv.innerHTML = `<pre>${escapeHtml(doc.documentElement.outerHTML)}</pre>`;
    }).catch(error => {
        console.error('Error reading file:', error);
    });
}

function createOutputDiv(tabDiv, title, index) {
    const outputDiv = document.createElement('div');
    outputDiv.style.padding = '10px';
    outputDiv.style.paddingBottom = '2px';

    const table = document.createElement('table');
    table.style.width = '100%';

    const tr = document.createElement('tr');
    const td = document.createElement('td');

    const accordionDiv = document.createElement('div');
    accordionDiv.className = 'accordion';
    accordionDiv.id = title.replace(/\s+/g, '_');
    accordionDiv.setAttribute('onclick', 'callMe(this)');

    const accordionTable = document.createElement('table');
    accordionTable.style.width = '100%';

    const accordionTr = document.createElement('tr');
    const leftTd = document.createElement('td');
    leftTd.style.textAlign = 'left';
    leftTd.innerHTML = `
        <img src="/CEWeb/Images/icons/Tick.svg" id="tick${index}" style="margin-bottom: -2px; margin-right: 7px; display:none;"/> &nbsp;${title}
    `;

    const rightTd = document.createElement('td');
    rightTd.style.textAlign = 'right';
    rightTd.innerHTML = `
        <img src="/CEWeb/Images/icons/arrow_accor.svg" id="${title.replace(/\s+/g, '_')}_UpArrow" style="margin-bottom: -2px; margin-right: 7px;"/>
        <img src="/CEWeb/Images/icons/arrow_accor1.svg" id="${title.replace(/\s+/g, '_')}_DownArrow" style="margin-bottom: -2px; margin-right: 7px; display: none;"/>
    `;

    accordionTr.appendChild(leftTd);
    accordionTr.appendChild(rightTd);
    accordionTable.appendChild(accordionTr);
    accordionDiv.appendChild(accordionTable);

    const panelDiv = document.createElement('div');
    panelDiv.className = 'panel';
    panelDiv.innerHTML = tabDiv.innerHTML;

    td.appendChild(accordionDiv);
    td.appendChild(document.createElement('br'));
    td.appendChild(panelDiv);
    tr.appendChild(td);
    table.appendChild(tr);

    outputDiv.appendChild(table);
    return outputDiv;
}

function callMe(elem) {
    console.log(elem);
    hideall(elem);
    $('html,body').animate({scrollTop: $(elem).position().top}, 'slow');
    elem.classList.toggle("active");
    var panel = elem.nextElementSibling.nextElementSibling;
    if (panel.style.display === "block") {
        panel.style.display = "none";
        elem.classList.toggle("active", false);
        panel.firstElementChild.style.display = "none";
    } else {
        panel.style.display = "block";
        panel.firstElementChild.style.display = "block";
        var id = elem.id;
        $("#" + id + "_UpArrow").show();
        $("#" + id + "_DownArrow").hide();
    }
}

function hideall(elem) {
    var accordion = document.getElementsByClassName("accordion");
    for (var i = 0; i < accordion.length; i++) {
        accordion[i].classList.toggle("active", false);
        var panel = accordion[i].nextElementSibling.nextElementSibling;
        if (accordion[i] == elem) {
        } else {
            if (panel.style.display === "block") {
                panel.style.display = "none";
                panel.firstElementChild.style.display = "none";
            }
        }
    }
    $("[id$='DownArrow']").show();
    $("[id$='UpArrow']").hide();
}

function escapeHtml(unsafe) {
    return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
}
</script>

</body>
</html>